<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dragon Game</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
</head>
<body>
    <h1>لعبة التنين الطائر</h1>
    <div id="game-container"></div>
    <script>
        async function main() {
            let pyodide = await loadPyodide({
                indexURL: "https://cdn.jsdelivr.net/pyodide/v0.24.1/full/"
            });
            await pyodide.loadPackage("pygame");
            await pyodide.loadPackage("pygame-ce");  // For pygame support in browser
            pyodide.runPython(`
import pygame
import random
import asyncio

pygame.init()

# إعداد الشاشة
WIDTH, HEIGHT = 800, 400
screen = pygame.display.set_mode((WIDTH, HEIGHT))
pygame.display.set_caption("لعبة التنين الطائر")

clock = pygame.time.Clock()
font = pygame.font.SysFont(None, 36)

# ألوان
BLACK = (0, 0, 0)
RED = (255, 0, 0)
ORANGE = (255, 140, 0)
WHITE = (255, 255, 255)

# التنين - زيادة الحجم قليلاً لتسهيل اللعب
dragon_x = 100
dragon_y = HEIGHT // 2
dragon_size = 50  # Increased from 40 for easier play
gravity = 0.4  # Reduced from 0.6 for slower fall
dragon_vel = 0

# العقبات (نيران) - تقليل الحجم والسرعة لتسهيل اللعب
fire_width = 20  # Reduced from 30
fire_height = 40  # Reduced from 60
fire_x = WIDTH
fire_y = random.randint(50, HEIGHT - 50)
fire_speed = 4  # Reduced from 6 for slower obstacles

# إضافة: قائمة الرصاص (bullets) لإطلاق النار
bullets = []  # List of [x, y] positions
bullet_speed = 8
bullet_size = 10

score = 0
game_over = False

# إضافة: نجوم الخلفية للماب ثلاثي الأبعاد (parallax starfield)
stars = [[random.randint(0, WIDTH), random.randint(0, HEIGHT), random.randint(1, 3)] for _ in range(100)]  # [x, y, speed]

def draw_text(text, x, y, color=WHITE):
    img = font.render(text, True, color)
    screen.blit(img, (x, y))

# إضافة: دالة لرسم التنين بشكل واضح
def draw_dragon(x, y, size):
    # الظل (shadow) لإضافة عمق ثلاثي الأبعاد
    pygame.draw.ellipse(screen, (50, 0, 0), (x + 5, y + size + 5, size, 10))
    # الجسم (body) كقطع ناقص لمظهر ثلاثي الأبعاد
    pygame.draw.ellipse(screen, RED, (x, y + size//4, size, size//2))
    # إضافة: لمعان (highlight) لزيادة التأثير الثلاثي الأبعاد
    pygame.draw.ellipse(screen, (255, 100, 100), (x + 2, y + size//4 + 2, size - 4, size//2 - 4))
    # الرأس (head)
    pygame.draw.circle(screen, RED, (x + size//2, y + size//4), size//4)
    # الأجنحة (wings)
    pygame.draw.polygon(screen, RED, [(x, y), (x - size//4, y + size//2), (x, y + size)])
    pygame.draw.polygon(screen, RED, [(x + size, y), (x + size + size//4, y + size//2), (x + size, y + size)])

# حلقة اللعبة
running = True
while running:
    clock.tick(60)
    screen.fill(BLACK)

    # إضافة: تحديث وحركة النجوم للتأثير الثلاثي الأبعاد
    for star in stars:
        star[0] -= star[2]  # Move left at different speeds
        if star[0] < 0:
            star[0] = WIDTH
            star[1] = random.randint(0, HEIGHT)

    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            running = False

        if event.type == pygame.KEYDOWN:
            if event.key == pygame.K_SPACE and not game_over:
                dragon_vel = -10  # Jump strength remains the same
            if event.key == pygame.K_s and not game_over:  # New: Shoot bullet
                bullets.append([dragon_x + dragon_size, dragon_y + dragon_size // 2])
            if event.key == pygame.K_r and game_over:
                # إعادة تشغيل - Reset game state
                dragon_y = HEIGHT // 2
                dragon_vel = 0
                fire_x = WIDTH
                score = 0
                fire_speed = 4  # Reset to slower speed
                bullets = []  # Reset bullets
                game_over = False

    if not game_over:
        # حركة التنين - Apply gravity and move
        dragon_vel += gravity
        dragon_y += dragon_vel
        # Clamp dragon position to screen boundaries to prevent going off-screen
        dragon_y = max(0, min(dragon_y, HEIGHT - dragon_size))

        # حركة النار - Move fire left, reset when off-screen
        fire_x -= fire_speed
        if fire_x < -fire_width:
            fire_x = WIDTH
            fire_y = random.randint(50, HEIGHT - 50)
            score += 1
            fire_speed += 0.2  # Slower increase in speed

        # إضافة: حركة الرصاص - Move bullets right and remove if off-screen
        for bullet in bullets[:]:
            bullet[0] += bullet_speed
            if bullet[0] > WIDTH:
                bullets.remove(bullet)

        # تصادم - Check for collisions with fire only (removed boundary death)
        dragon_rect = pygame.Rect(dragon_x, dragon_y, dragon_size, dragon_size)
        fire_rect = pygame.Rect(fire_x, fire_y, fire_width, fire_height)

        # إضافة: تحقق من تصادم الرصاص مع النار
        for bullet in bullets[:]:
            bullet_rect = pygame.Rect(bullet[0], bullet[1], bullet_size, bullet_size)
            if bullet_rect.colliderect(fire_rect):
                bullets.remove(bullet)
                fire_x = WIDTH  # Reset fire position
                fire_y = random.randint(50, HEIGHT - 50)
                score += 5  # Bonus points for hitting fire
                fire_speed += 0.1  # Slight speed increase

        if dragon_rect.colliderect(fire_rect):
            game_over = True

    # إضافة: رسم النجوم الخلفية
    for star in stars:
        pygame.draw.circle(screen, WHITE, (star[0], star[1]), 1)

    # رسم التنين - Draw dragon with detailed shape
    draw_dragon(dragon_x, dragon_y, dragon_size)

    # رسم النار - Draw fire as space vehicle (triangular polygon) with shadow
    # الظل للعدو
    pygame.draw.polygon(screen, (100, 50, 0), [(fire_x + 2, fire_y + fire_height + 2), (fire_x + fire_width//2 + 2, fire_y + 2), (fire_x + fire_width + 2, fire_y + fire_height + 2)])
    # شكل المركبة الفضائية
    pygame.draw.polygon(screen, ORANGE, [(fire_x, fire_y + fire_height), (fire_x + fire_width//2, fire_y), (fire_x + fire_width, fire_y + fire_height)])

    # إضافة: رسم الرصاص - Draw bullets as small red rectangles
    for bullet in bullets:
        pygame.draw.rect(screen, RED, (bullet[0], bullet[1], bullet_size, bullet_size))

    # النقاط - Display score
    draw_text(f"النقاط: {score}", 10, 10)

    if game_over:
        draw_text("انتهت اللعبة!", WIDTH//2 - 100, HEIGHT//2 - 30, RED)
        draw_text("اضغط R لإعادة اللعب", WIDTH//2 - 130, HEIGHT//2 + 10)

    pygame.display.update()

pygame.quit()
            `);
        }
        main();
    </script>
</body>
</html>
